# WMMC用『マイコン沼に嵌ろう！』資料集
2018年度新入生ゼミに発表させて頂く内容の資料とソースコード配布用のリポジトリです。以下を含んでいます。

- STM32/
    - startup.c
        - STM32F303K8Tx 用に書いた、スタートアップルーチンのC言語実装版です。IDE で作成したプロジェクトディレクトリの良い感じのところに置けばいいでしょう。
    - Makefile
        - IDEを捨て、コマンドラインでSTM32F3マイコンを開発するための Makefile です。プロジェクトディレクトリを作成し、ルートに置いてください。ソースコードは `src/` 内においてください。リンカスクリプトもルートに置き、`LinkerScript.ld` とすることでビルドが可能になります。
    - LinkerScript.ld
        - 必要最小限の F303 用リンカスクリプトです。**C言語に要求されているセクションのみしか記載していません**ので、C++で用いると怒られると思います。また`.init`, `.fini` セクションを DISCARD しているので `constructor`, `destructor` 属性は使用できません。使用したい場合は `/DISCARD/` の中の2行を削除してください。
    - blink.asm
        - Lチカのアセンブラ版(F303向け)です**\*注**。
    - hand\_assemble.lst
        - アセンブラを使わず紙と鉛筆によってハンドアセンブルしたLチカプログラムです。F303向けで、生成したバイナリを `arm-none-eabi-objdump` にかけた出力結果となります。
- LPC/
    - myStruct.h
        - LPC1114 用に実装した、Renesas社マイコン風のIOレジスタマクロです。
- RX/
    - linker.ld
        - RX220 マイコン用に作成した **C言語用**のリンカスクリプトです。2種類のスタックも実装しています。
    - startup.s
        - RX220 マイコン用のスタートアップルーチンです。RX アーキテクチャのC言語に寄せた(と思われる)命令を有効に活用し、最小限の構成としています。もちろん割り込みも正常に動作します。

**\*注:** `STM32/blink.asm` は以下のコマンドでビルドしてください。

```bash
$ arm-none-eabi-as -mcpu=cortex-m4 -mthumb -o blink.o blink.asm
$ arm-none-eabi-ld -Ttext 0x08000000 -o blink.elf blink.o
```

- resume/
    - untitled.tex/pdf
        - 発表した内容について、ソースコードを一部省略して記載した補足 PDF です。ディレクトリ内には TeX のソースファイルと完成した pdf ファイルが入っています。
    - handAssemble.pdf
        - ハンドアセンブル時に書いた紙をスキャンしたデータです。横にちょこちょこと書いてある補数計算や PC のオフセット計算に一部誤りがありますが、左側のニーモニック、16進数オペコードは合っていることは確認しています。

# 引用・転載について
改変の自由等は特に制限しませんが、本リポジトリ内のコードを少しでも引用、改変をし自身の作品に利用された場合は本リポジトリのアドレスを併記してください。
